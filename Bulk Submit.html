<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bulk Document Submission</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'sans-serif'] },
          colors: {
            primary: { 50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc', 400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 800: '#3730a3', 900: '#312e81' },
            success: { 600: '#16a34a', 700: '#15803d' }
          }
        }
      }
    }
  </script>
  <style>
    body { background-color: #f8fafc; }
    .card { background:#fff; border:1px solid #e5e7eb; border-radius:1rem; box-shadow:0 4px 6px -1px rgb(0 0 0 / .05), 0 2px 4px -2px rgb(0 0 0 / .05); }
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 8px; }
    .badge { padding: 2px 8px; border-radius: 9999px; font-size: .75rem; font-weight: 600; display: inline-flex; align-items:center; gap:6px; }
    .badge-draft { background:#dbeafe; color:#1e40af; }
    .badge-submitted { background:#dcfce7; color:#166534; }
    .badge-none { background:#e2e8f0; color:#334155; }
  </style>
</head>
<body class="font-sans text-slate-800">
  <header class="bg-white/90 backdrop-blur-sm border-b border-slate-200 sticky top-0 z-50">
    <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between py-3">
        <a href="./index.html" class="flex items-center gap-2" title="Back to Hub">
          <span class="inline-flex h-8 w-8 rounded-lg bg-primary-600 text-white items-center justify-center font-extrabold">P</span>
          <span class="text-sm font-semibold text-gray-900">PPAP Hub</span>
        </a>
        <nav class="flex items-center gap-1">
          <a href="./PPAP Creation Page.html" class="px-3 py-2 text-sm font-medium rounded-md text-slate-700 hover:text-primary-700 hover:bg-primary-50">Creation</a>
          <a href="./PPAP View Page.html" class="px-3 py-2 text-sm font-medium rounded-md text-slate-700 hover:text-primary-700 hover:bg-primary-50">View</a>
          <a href="./Bulk Submit.html" class="px-3 py-2 text-sm font-medium rounded-md bg-primary-600 text-white hover:bg-primary-700">Bulk Submit</a>
        </nav>
      </div>
    </div>
  </header>

  <main class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <div class="card p-5 sm:p-6">
      <div class="flex items-start justify-between gap-4 flex-wrap">
        <div>
          <h1 class="text-2xl font-bold text-slate-900">Bulk Document Submission</h1>
          <p id="progressText" class="text-slate-600 text-sm mt-1">0 of 29 elements have files attached.</p>
          <div class="w-56 h-2 bg-slate-200 rounded-full mt-2 overflow-hidden">
            <div id="progressBar" class="h-2 bg-primary-600 rounded-full" style="width:0%"></div>
          </div>
        </div>
        <button id="submitBtn" class="px-5 py-2.5 bg-primary-600 text-white font-semibold rounded-lg shadow-sm hover:bg-primary-700 disabled:bg-slate-400 disabled:cursor-not-allowed flex items-center gap-2" disabled>
          Submit Selected (0)
        </button>
      </div>

      <div class="mt-6 overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-slate-50 text-slate-600 uppercase text-xs">
            <tr>
              <th class="p-3 w-12"></th>
              <th class="p-3 text-left">Element</th>
              <th class="p-3 text-left">Required</th>
              <th class="p-3 text-left">Status</th>
              <th class="p-3 text-left w-64">Files</th>
            </tr>
          </thead>
          <tbody id="tableBody" class="align-top"></tbody>
        </table>
      </div>
    </div>
  </main>

  <footer class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <div class="card p-4 flex items-center justify-between">
      <a href="./index.html" class="px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 font-semibold flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
        Back to Hub
      </a>
      <div class="text-sm text-slate-500">Attach files, select rows, and submit.</div>
    </div>
  </footer>

  <div id="toast" class="fixed bottom-5 right-5 hidden px-4 py-2 rounded-lg text-white shadow-lg"></div>

  <script>
    const elements = [
      { id: 1, name: 'Design Records (Preliminary)', phase: 1, requirement: 'Required' },
      { id: 2, name: 'Authorized Engineering Changes (if available)', phase: 1, requirement: 'If applicable' },
      { id: 3, name: 'Customer Engineering Approval (if required)', phase: 1, requirement: 'As requested' },
      { id: 4, name: 'DFMEA (initial draft)', phase: 1, requirement: 'Required' },
      { id: 5, name: 'Process Flow Diagram (conceptual)', phase: 1, requirement: 'Required' },
      { id: 6, name: 'Updated DFMEA', phase: 2, requirement: 'Required' },
      { id: 7, name: 'Preliminary PFMEA (draft)', phase: 2, requirement: 'Required' },
      { id: 8, name: 'Draft Control Plan (prototype)', phase: 2, requirement: 'Required' },
      { id: 9, name: 'Material & Performance Test Plan (if defined)', phase: 2, requirement: 'Optional' },
      { id: 10, name: 'Preliminary MSA Plan (gage strategy)', phase: 2, requirement: 'Optional' },
      { id: 11, name: 'Finalized PFMEA', phase: 3, requirement: 'Required' },
      { id: 12, name: 'Control Plan (Pre-launch version)', phase: 3, requirement: 'Required' },
      { id: 13, name: 'Gage R&R / MSA Studies (initial)', phase: 3, requirement: 'As requested' },
      { id: 14, name: 'Dimensional Results (preliminary layout)', phase: 3, requirement: 'Required' },
      { id: 15, name: 'Material Test Reports (trial runs)', phase: 3, requirement: 'Required' },
      { id: 16, name: 'SPC Plan defined', phase: 3, requirement: 'Optional' },
      { id: 17, name: 'Final PFMEA', phase: 4, requirement: 'Required' },
      { id: 18, name: 'Final Control Plan (Production version)', phase: 4, requirement: 'Required' },
      { id: 19, name: 'MSA Studies (complete)', phase: 4, requirement: 'Required' },
      { id: 20, name: 'Dimensional Results (full layout)', phase: 4, requirement: 'Required' },
      { id: 21, name: 'Records of Material / Performance Tests (certified results)', phase: 4, requirement: 'Required' },
      { id: 22, name: 'Initial Process Studies (Cp, Cpk)', phase: 4, requirement: 'As requested' },
      { id: 23, name: 'Appearance Approval Report (if applicable)', phase: 4, requirement: 'If applicable' },
      { id: 24, name: 'Checking Aids documentation', phase: 4, requirement: 'Optional' },
      { id: 25, name: 'Master Sample', phase: 5, requirement: 'Required' },
      { id: 26, name: 'Customer-Specific Requirements (fulfilled)', phase: 5, requirement: 'Required' },
      { id: 27, name: 'Part Submission Warrant (PSW) signed-off', phase: 5, requirement: 'Required' },
      { id: 28, name: 'Ongoing SPC and capability studies', phase: 5, requirement: 'As requested' },
      { id: 29, name: 'Lessons Learned / Feedback loop', phase: 5, requirement: 'If applicable' },
    ].map(e => ({ ...e, files: [], status: 'Not Submitted', selected: false }));

    const phases = [
      { id: 1, name: 'Phase 1 – Planning & Definition' },
      { id: 2, name: 'Phase 2 – Design & Development' },
      { id: 3, name: 'Phase 3 – Process Design & Development' },
      { id: 4, name: 'Phase 4 – Product & Process Validation' },
      { id: 5, name: 'Phase 5 – Feedback, Assessment & Corrective Action' },
    ];

    const tableBody = document.getElementById('tableBody');
    const submitBtn = document.getElementById('submitBtn');
    const toast = document.getElementById('toast');

    function requirementBadge(req){
      if (req === 'Required') return '<span class="badge" style="background:#dcfce7;color:#166534">Required</span>';
      if (req === 'If applicable') return '<span class="badge" style="background:#dbeafe;color:#1e40af">If applicable</span>';
      if (req === 'As requested') return '<span class="badge" style="background:#f3e8ff;color:#6b21a8">As requested</span>';
      return '<span class="badge" style="background:#e2e8f0;color:#334155">Optional</span>';
    }

    function statusBadge(status){
      if (status === 'Draft') return '<span class="badge badge-draft">Draft</span>';
      if (status === 'Submitted') return '<span class="badge badge-submitted">Submitted</span>';
      return '<span class="badge badge-none">Not Submitted</span>';
    }

    function render(){
      tableBody.innerHTML = '';
      phases.forEach(phase => {
        const phaseEls = elements.filter(e => e.phase === phase.id);
        if (phaseEls.length === 0) return;
        const header = document.createElement('tr');
        header.innerHTML = `<td colspan="5" class="bg-slate-200 border-y-2 border-slate-300 px-4 py-2 font-bold text-slate-800">${phase.name}</td>`;
        tableBody.appendChild(header);

        phaseEls.forEach(el => {
          const tr = document.createElement('tr');
          tr.className = 'even:bg-slate-50';
          tr.innerHTML = `
            <td class="p-3 align-top"><input type="checkbox" class="h-5 w-5 text-primary-600 border-gray-300 rounded row-select" data-id="${el.id}" ${el.selected ? 'checked' : ''}></td>
            <td class="p-3 align-top text-slate-800 font-medium">${el.name}</td>
            <td class="p-3 align-top">${requirementBadge(el.requirement)}</td>
            <td class="p-3 align-top">${statusBadge(el.status)}</td>
            <td class="p-3 align-top">
              <div class="flex items-center gap-2">
                <input id="file-${el.id}" type="file" class="hidden" multiple />
                <button class="px-3 py-1.5 bg-white border border-slate-300 rounded-md hover:bg-slate-50 text-slate-700 text-sm" data-action="add-files" data-id="${el.id}">Add Files</button>
                <span class="text-sm text-slate-600">${el.files.length} ${el.files.length === 1 ? 'file' : 'files'}</span>
                <button class="text-xs text-primary-700 hover:underline" data-action="toggle-files" data-id="${el.id}">Details</button>
              </div>
              <div id="details-${el.id}" class="mt-2 hidden">
                ${el.files.length ? el.files.map(f => `<div class='flex items-center justify-between bg-slate-50 border border-slate-200 rounded-md px-2 py-1 mb-1'><span class='truncate text-sm text-slate-700' title='${f.name}'>${f.name} • ${(f.size/1024).toFixed(1)} KB</span><button class='text-red-600 text-xs' data-action='remove-file' data-id='${el.id}' data-file='${f._id}'>Remove</button></div>`).join('') : `<div class='text-sm text-slate-500'>No files attached.</div>`}
              </div>
            </td>`;
          tableBody.appendChild(tr);
        });
      });

      updateProgress();
      updateSubmitState();
    }

    function updateProgress(){
      const withFiles = elements.filter(e => e.files.length > 0).length;
      const pct = (withFiles / elements.length) * 100;
      document.getElementById('progressText').textContent = `${withFiles} of ${elements.length} elements have files attached.`;
      document.getElementById('progressBar').style.width = `${pct}%`;
    }

    function updateSubmitState(){
      const selectedCount = elements.filter(e => e.selected).length;
      submitBtn.disabled = selectedCount === 0;
      submitBtn.textContent = `Submit Selected (${selectedCount})`;
    }

    function showToast(message, ok=true){
      toast.textContent = message;
      toast.className = `fixed bottom-5 right-5 px-4 py-2 rounded-lg text-white shadow-lg ${ok ? 'bg-green-600' : 'bg-red-600'}`;
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('hidden'), 2500);
    }

    // Delegated events
    tableBody.addEventListener('click', (e) => {
      const btn = e.target.closest('button');
      const checkbox = e.target.closest('.row-select');
      if (checkbox){
        const id = +checkbox.dataset.id;
        const el = elements.find(x => x.id === id);
        el.selected = checkbox.checked;
        updateSubmitState();
        return;
      }
      if (!btn) return;
      const id = +btn.dataset.id;
      const el = elements.find(x => x.id === id);
      const action = btn.dataset.action;
      if (action === 'add-files'){
        const input = document.getElementById(`file-${id}`);
        input.onchange = () => {
          const files = Array.from(input.files).map(f => ({ name: f.name, size: f.size, _id: `${Date.now()}-${Math.random().toString(36).slice(2)}` }));
          el.files.push(...files);
          el.status = 'Draft';
          render();
          const details = document.getElementById(`details-${id}`);
          if (details && !details.classList.contains('hidden')) details.classList.remove('hidden');
          input.value = '';
        }
        input.click();
      }
      if (action === 'toggle-files'){
        const details = document.getElementById(`details-${id}`);
        if (details) details.classList.toggle('hidden');
      }
      if (action === 'remove-file'){
        // handled below via separate branch (since remove-file buttons are inside details)
      }
    });

    tableBody.addEventListener('click', (e) => {
      const removeBtn = e.target.closest('button[data-action="remove-file"]');
      if (!removeBtn) return;
      const id = +removeBtn.dataset.id;
      const fileId = removeBtn.dataset.file;
      const el = elements.find(x => x.id === id);
      el.files = el.files.filter(f => f._id !== fileId);
      if (el.files.length === 0 && el.status !== 'Submitted') el.status = 'Not Submitted';
      render();
      const details = document.getElementById(`details-${id}`);
      if (details) details.classList.remove('hidden');
    });

    submitBtn.addEventListener('click', () => {
      const selected = elements.filter(e => e.selected);
      if (selected.some(e => e.files.length === 0)){
        showToast('Cannot submit. Some selected elements have no files.', false);
        return;
      }
      selected.forEach(e => { e.status = 'Submitted'; e.selected = false; });
      render();
      showToast(`Successfully submitted ${selected.length} element(s).`);
    });

    render();
  </script>
</body>
</html>
